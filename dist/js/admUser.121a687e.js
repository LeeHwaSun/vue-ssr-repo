(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["admUser"],{"08b3":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:i}){return[e("v-avatar",t._g(t._b({attrs:{size:t.size,color:t.LV_COLOR(t.level)}},"v-avatar",i,!1),s),[e("span",{staticStyle:{color:"#121212"}},[t._v(t._s(t.level))])])]}}])},[e("span",[t._v(t._s(t.LV_LABEL(t.level)))])])},a=[],o=s("bb5e"),r={name:"DisplayLevel",props:{level:{type:[Number,String],required:!0},size:{type:[String,Number],default:24}},computed:{LV_COLOR:()=>o["LV_COLOR"],LV_LABEL:()=>o["LV_LABEL"]}},l=r,n=s("2877"),u=Object(n["a"])(l,i,a,!1,null,null,null);e["a"]=u.exports},"2f90":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("v-dialog",t._b({model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},"v-dialog",t.$attrs,!1),[e("v-card",[e("v-toolbar",t._b({},"v-toolbar",t.$attrs,!1),[e("v-toolbar-title",[t._v(t._s(t.label))]),e("v-spacer"),e("v-btn",{attrs:{icon:""},on:{click:t.close}},[e("v-icon",[t._v("mdi-close")])],1)],1),e("v-card-text",[t._t("default")],2)],1)],1)},a=[],o={name:"MyDialog",props:{label:{type:String,required:!0}},data(){return{dialog:!1}},methods:{open(){this.$emit("onOpen"),this.dialog=!0},close(){this.$emit("onClose"),this.dialog=!1}}},r=o,l=s("2877"),n=Object(l["a"])(r,i,a,!1,null,null,null);e["a"]=n.exports},de51:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("v-container",{attrs:{fluid:""}},[e("v-toolbar",[e("v-toolbar-title",[t._v("회원관리")]),e("search-field",{attrs:{items:t.searchItems,options:t.options},on:{"update:options":function(e){t.options=e}}}),e("v-spacer"),e("v-sheet",{staticClass:"mt-2",attrs:{width:"60",color:"transparent"}},[e("v-select",{attrs:{items:t.pageItems,label:"목록 수","hide-details":"",dense:""},model:{value:t.options.itemsPerPage,callback:function(e){t.$set(t.options,"itemsPerPage",e)},expression:"options.itemsPerPage"}})],1),e("v-sheet",{staticClass:"mt-2 ml-4",attrs:{width:"100",color:"transparent"}},[e("v-select",{attrs:{items:t.typeItems,label:"회원유형","hide-details":"",dense:""},on:{change:function(e){t.options.page=1}},model:{value:t.options.type,callback:function(e){t.$set(t.options,"type",e)},expression:"options.type"}})],1)],1),e("v-data-table",{attrs:{headers:t.headers,items:t.items,options:t.options,"server-items-length":t.totalItems,loading:t.loading,"hide-default-footer":""},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"item.user_id",fn:function({item:t}){return[e("display-id",{attrs:{user:t}})]}},{key:"item.user_name",fn:function({item:t}){return[e("display-name",{attrs:{user:t}})]}},{key:"item.user_level",fn:function({item:t}){return[e("display-level",{attrs:{level:t.user_level}})]}},{key:"item.user_create_at",fn:function({item:t}){return[e("display-time",{attrs:{time:t.user_create_at}})]}},{key:"item.user_update_at",fn:function({item:t}){return[e("display-time",{attrs:{time:t.user_update_at}})]}},{key:"item.user_leave_at",fn:function({item:s}){return[s.user_leave_at?e("display-time",{attrs:{time:s.user_leave_at}}):t._e()]}},{key:"item.cmd",fn:function({item:s}){return[e("tooltip-btn",{attrs:{icon:"",label:"Modify"},on:{click:function(e){return t.openDialog(s)}}},[e("v-icon",[t._v("mdi-pencil")])],1)]}}])}),e("v-pagination",{staticClass:"mt-4",attrs:{length:t.pageCount},model:{value:t.options.page,callback:function(e){t.$set(t.options,"page",e)},expression:"options.page"}}),e("my-dialog",{ref:"dialog",attrs:{label:"회원 수정",width:"500",persistent:""},on:{onClose:t.closeDialog}},[t.curUser?e("user-update-form",{attrs:{user:t.curUser,isLoading:t.loading,admMode:!0},on:{onSave:t.saveUser,onLeave:t.leaveUser,onRestore:t.restoreUser}}):t._e()],1)],1)},a=[],o=s("4328"),r=s.n(o),l=s("fc1f"),n=s("ed2f"),u=s("2f90"),c=s("e223"),p=s("64f2"),m=function(){var t=this,e=t._self._c;return t.user.user_provider?e("div",[e("v-tooptip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:i}){return[e("span",t._g(t._b({},"span",i,!1),s),[e("v-icon",{attrs:{left:"",small:""}},[t._v("mdi-account-network")]),t._v(" "+t._s(t.user.user_provider.toUpperCase())+" ")],1)]}}],null,!1,3927850431)},[e("span",[t._v(t._s(t.user.user_id))])])],1):e("div",[t._v(" "+t._s(t.user.user_id)+" ")])},h=[],d={name:"DisplayId",props:{user:{type:Object,required:!0}}},f=d,v=s("2877"),_=Object(v["a"])(f,m,h,!1,null,null,null),g=_.exports,y=function(){var t=this,e=t._self._c;return e("div",[e("display-avatar",{attrs:{user:t.user,size:t.size}}),e("span",{staticClass:"ml-2"},[t._v(t._s(t.user.user_name))])],1)},b=[],x=s("5fb3"),$={components:{DisplayAvatar:x["a"]},name:"DisplayName",props:{user:{type:Object,required:!0},size:{type:[String,Number],default:24}}},k=$,L=Object(v["a"])(k,y,b,!1,null,null,null),D=L.exports,O=s("08b3"),S=s("fe6b"),U=s("bc3a"),w=s.n(U),C={components:{SearchField:l["a"],TooltipBtn:n["a"],MyDialog:u["a"],UserUpdateForm:c["a"],DisplayId:g,DisplayName:D,DisplayLevel:O["a"],DisplayTime:S["a"]},name:"AdmUser",title:"회원 관리",data(){return{headersOrigin:[{text:"아이디",value:"user_id",align:"start",searchable:!0},{text:"이름",value:"user_name",align:"start",searchable:!0},{text:"이메일",value:"user_email",align:"start",searchable:!0},{text:"연락처",value:"user_phone",align:"start",searchable:!0},{text:"레벨",value:"user_level",align:"start",searchable:!0},{text:"가입일",value:"user_create_at",align:"start"},{text:"수정일",value:"user_update_at",align:"start"},{text:"탈퇴일",value:"user_leave_at",align:"start"},{text:"CMD",value:"cmd",sortable:!1}],items:[],options:{},totalItems:0,loading:!1,pageReady:!1,pageRouting:!1,axiosSource:null,curUser:null,typeItems:[{text:"전체",value:"all"},{text:"회원",value:"user"},{text:"탈퇴회원",value:"leave"}],pageItems:[2,5,10,20,50,100]}},computed:{searchItems(){return this.headers.filter(t=>t.searchable)},headers(){return"user"==this.options.type?this.headersOrigin.filter(t=>"user_leave_at"!=t.value):"leave"==this.options.type?this.headersOrigin.filter(t=>"user_update_at"!=t.value):this.headersOrigin.filter(t=>""!=t.value)},pageCount(){return Math.ceil(this.totalItems/this.options.itemsPerPage)}},watch:{options:{handler(){this.fetchData()},deep:!0}},created(){this.options=this.initOptions()},mounted(){window.addEventListener("popstate",this.routeChange)},destroyed(){window.removeEventListener("popstate",this.routeChange)},methods:{initOptions(){const{query:t}=this.$route,e={page:Number(t.page)||1,itemsPerPage:Number(t.itemsPerPage)||10,sortBy:[t.sortBy||"user_create_at"],sortDesc:[!!t.sortDesc&&"true"==t.sortDesc],stf:[t.stf||""],stx:[t.stx||""],stc:[t.stc||""],type:t.type||"all"};return e},routeChange(){this.pageRouting=!0,this.options=this.initOptions()},async fetchData(){console.log("fetchData call..."),this.axiosSource&&this.axiosSource.cancel("fetchData 취소"),this.loading=!0;const t=Object(p["deepCopy"])(this.options);"user"==t.type?(t.stf.push("user_leave_at"),t.stx.push("n"),t.stc.push("null")):"leave"==this.options.type&&(t.stf.push("user_leave_at"),t.stx.push("n"),t.stc.push("not")),delete t.type;const e=r.a.stringify(t);this.axiosSource=w.a.CancelToken.source();try{const t=await this.$axios.get("/api/user?"+e,{cancelToken:this.axiosSource.token});this.pushState(),this.loading=!1,this.pageReady=!0,this.pageRouting=!1,t&&(this.items=t.items,this.totalItems=t.totalItems)}catch(s){console.log("request cancel >",s.message)}},pushState(){if(console.log("pageRouting",this.pageRouting),!this.pageRouting){const t={page:this.options.page,itemsPerPage:this.options.itemPerPage,sortBy:this.options.sortBy[0],sortDesc:this.options.sortDesc[0],stf:this.options.stf[0]||void 0,stx:this.options.stx[0]||void 0,stc:this.options.stc[0]||void 0,type:this.options.type},e=r.a.stringify(t);this.pageReady?history.pushState(null,null,`${this.$route.path}?${e}`):history.replaceState(null,null,`${this.$route.path}?${e}`)}},openDialog(t){this.curUser=t,this.$refs.dialog.open()},closeDialog(){this.curUser=null},async saveUser(t){this.loading=!0;const e=await this.$axios.patch("/api/user",t);if(this.loading=!1,e){const t=this.items.indexOf(this.curUser);this.items.splice(t,1,e),this.$toast.info(e.user_name+" 정보 수정 하였습니다."),this.$socket.emit("user:admUpdate",e),this.$refs.dialog.close()}},async leaveUser(){const t=await this.$myNotify.confirm(this.curUser.user_name+" 회원 탈퇴 처리하시겠습니까?","회원탈퇴 처리",{icon:"mdi-alert"});if(!t)return;this.loading=!0;const e={user_id:this.curUser.user_id,user_leave_at:this.$moment().format("LT")},s=await this.$axios.patch("/api/user",e);s&&(this.$toast.info(this.curUser.user_name+"님 탈퇴 처리 하였습니다."),this.$refs.dialog.close(),this.pageRouting=!0,this.fetchData())},async restoreUser(){const t=await this.$myNotify.confirm(this.curUser.user_name+" 회원 복원 처리하시겠습니까?","회원탈퇴 처리",{icon:"mdi-alert"});if(!t)return;this.loading=!0;const e={user_id:this.curUser.user_id,user_leave_at:null},s=await this.$axios.patch("/api/user",e);s&&(this.$toast.info(this.curUser.user_name+"님 복원 처리 하였습니다."),this.$refs.dialog.close(),this.pageRouting=!0,this.fetchData())}}},T=C,N=Object(v["a"])(T,i,a,!1,null,null,null);e["default"]=N.exports},ed2f:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:i}){return[e("v-btn",t._g(t._b({class:t.childClass,attrs:{icon:""},on:{click:function(e){return t.$emit("click")}}},"v-btn",{...t.$attrs,...i},!1),s),[t._t("default")],2)]}}],null,!0)},[e("span",[t._v(t._s(t.label))])])},a=[],o={name:"TooltipBtn",props:{label:{type:String,required:!0},childClass:[String,Object]}},r=o,l=s("2877"),n=Object(l["a"])(r,i,a,!1,null,null,null);e["a"]=n.exports},fc1f:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",[e("tooltip-btn",{attrs:{label:t.searchLabel,icon:"",small:""},on:{click:t.open}},[e("v-icon",[t._v("mdi-magnify")])],1),t.options.stf[0]?e("tooltip-btn",{attrs:{type:"button",label:"검색 초기화",icon:"",color:"error",small:""},on:{click:t.reset}},[e("v-icon",[t._v("mdi-magnify-close")])],1):t._e(),e("my-dialog",{ref:"dialog",attrs:{label:t.label,width:"300"}},[e("v-form",{ref:"form",attrs:{"lazy-validation":""},on:{submit:function(e){return e.preventDefault(),t.searchGo.apply(null,arguments)}},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e("v-select",{attrs:{label:"검색 필드",items:t.items,rules:[t.rules.required({label:"검색 필드"})]},model:{value:t.form.stf,callback:function(e){t.$set(t.form,"stf",e)},expression:"form.stf"}}),e("v-select",{attrs:{label:"비교방식",items:t.compItems},model:{value:t.form.stc,callback:function(e){t.$set(t.form,"stc",e)},expression:"form.stc"}}),e("v-text-field",{attrs:{label:"검색어",rules:[t.rules.required({label:"검색어"})],disabled:t.isNullComp},model:{value:t.form.stx,callback:function(e){t.$set(t.form,"stx",e)},expression:"form.stx"}}),e("div",{staticClass:"d-flex"},[e("tooltip-btn",{attrs:{type:"button",label:"Reset",icon:"",color:"error"},on:{click:t.reset}},[e("v-icon",[t._v("mdi-magnify-close")])],1),e("v-spacer"),e("tooltip-btn",{attrs:{type:"submit",label:"Search",icon:"",color:"primary"}},[e("v-icon",[t._v("mdi-magnify")])],1)],1)],1)],1)],1)},a=[],o=s("ed2f"),r=s("2f90"),l=s("248f"),n=s.n(l),u={components:{TooltipBtn:o["a"],MyDialog:r["a"]},name:"SearchField",props:{label:{type:String,default:"Search"},items:{type:Array,requird:!0},options:{type:Object,required:!0}},data(){return{valid:!0,form:{stf:"",stx:"",stc:""},compItems:[{text:"포함",value:"like"},{text:"작은",value:"lt"},{text:"작거나 같은",value:"lte"},{text:"같은",value:"eq"},{text:"크거나 같은",value:"gte"},{text:"큰",value:"gt"},{text:"같지 않은",value:"ne"},{text:"NULL",value:"null"},{text:"NOT NULL",value:"not"}],tempText:""}},computed:{rules:()=>n.a,searchLabel(){const t=this.items.find(t=>t.value==this.options.stf);return t?`${t.text} : ${this.options.stx}`:this.label},isNullComp(){return"null"==this.form.stc||"not"==this.form.stc?(this.tempText||(this.tempText=this.form.stx,this.form.stx="Null"),!0):(this.tempText&&(this.form.stx=this.tempText,this.tempText=""),!1)}},methods:{open(){this.form.stf=this.options.stf[0]||this.items[0].value,this.form.stc=this.options.stc[0]||"like",this.form.stx=this.options.stx[0],this.$refs.form&&this.$refs.form.resetValidation(),this.$refs.dialog.open()},async searchGo(){if(this.$refs.form.validate(),await this.$nextTick(),!this.valid)return;const t={...this.options,page:1};t.stf.splice(0,1,this.form.stf),t.stc.splice(0,1,this.form.stc),t.stx.splice(0,1,this.form.stx),this.$emit("update:options",t),this.$refs.dialog.close()},reset(){const t={...this.options,page:1};t.stf.splice(0,1,""),t.stc.splice(0,1,""),t.stx.splice(0,1,""),this.$emit("update:options",t),this.$refs.dialog.close()}}},c=u,p=s("2877"),m=Object(p["a"])(c,i,a,!1,null,null,null);e["a"]=m.exports},fe6b:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:i}){return[e("span",t._g(t._b({},"span",i,!1),s),[t._v(" "+t._s(t.display)+" ")])]}}])},[t._v(" "+t._s(t.formatTime)+" ")])},a=[],o={name:"DisplayTime",props:{time:{type:String,required:!0}},computed:{formatTime(){return this.$moment(this.time).format("LLL")},display(){const t=this.$moment(this.time),e=this.$moment(),s=e.diff(t,"days");return s>0?t.format("LL"):t.fromNow()}}},r=o,l=s("2877"),n=Object(l["a"])(r,i,a,!1,null,null,null);e["a"]=n.exports}}]);
//# sourceMappingURL=admUser.121a687e.js.map