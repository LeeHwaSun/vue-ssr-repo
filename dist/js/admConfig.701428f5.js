(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["admConfig"],{"2f90":function(t,e,i){"use strict";var s=function(){var t=this,e=t._self._c;return e("v-dialog",t._b({model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},"v-dialog",t.$attrs,!1),[e("v-card",[e("v-toolbar",t._b({},"v-toolbar",t.$attrs,!1),[e("v-toolbar-title",[t._v(t._s(t.label))]),e("v-spacer"),e("v-btn",{attrs:{icon:""},on:{click:t.close}},[e("v-icon",[t._v("mdi-close")])],1)],1),e("v-card-text",[t._t("default")],2)],1)],1)},a=[],o={name:"MyDialog",props:{label:{type:String,required:!0}},data(){return{dialog:!1}},methods:{open(){this.$emit("onOpen"),this.dialog=!0},close(){this.$emit("onClose"),this.dialog=!1}}},r=o,l=i("2877"),n=Object(l["a"])(r,s,a,!1,null,null,null);e["a"]=n.exports},9415:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;return e("v-container",{attrs:{fluid:""}},[e("v-toolbar",{staticClass:"mt-2"},[e("v-toolbar-title",[t._v("설정관리")]),e("v-spacer"),e("tooltip-btn",{attrs:{fab:"",small:"",label:"Add",color:"primary"},on:{click:t.addConfig}},[e("v-icon",[t._v("mdi-plus")])],1),e("tooltip-btn",{attrs:{fab:"",small:"",label:"Restart",color:"error",chlidClass:"ml-2",loading:t.restart},on:{click:t.restartServer}},[e("v-icon",[t._v("mdi-power")])],1)],1),e("v-row",{staticClass:"mt-2"},[e("v-col",[e("v-tabs",{attrs:{"background-color":"primary",dark:""},model:{value:t.group,callback:function(e){t.group=e},expression:"group"}},t._l(t.groupItems,(function(i){return e("v-tab",{key:i.cfg_key},[t._v(" "+t._s(i)+" ")])})),1)],1)],1),e("draggable",{staticClass:"list-group mt-5",attrs:{tag:"ul",list:t.curItems,handle:".handle"},on:{end:t.sortEnd}},t._l(t.curItems,(function(i){return e("config-item",{key:i.cfg_key,staticClass:"list-group-item",attrs:{item:i},on:{update:t.updateConfig,remove:t.removeConfig}})})),1),e("my-dialog",{ref:"dialog",attrs:{label:"설정 추가","max-width":"500",persistent:""}},[e("config-form",{ref:"configForm",staticClass:"mt-5",attrs:{keyCheck:t.keyCheck,groupItems:t.groupItems,item:t.item},on:{save:t.save}})],1)],1)},a=[],o=i("2f62"),r=i("ed2f"),l=i("2f90"),n=function(){var t=this,e=t._self._c;return t.user?e("v-form",{ref:"form",attrs:{"lazy-validation":""},on:{submit:function(e){return e.preventDefault(),t.save.apply(null,arguments)}},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e("v-combobox",{attrs:{items:t.groupItems,label:"그룹",rules:[t.rules.required({label:"그룹"})]},model:{value:t.form.cfg_group,callback:function(e){t.$set(t.form,"cfg_group",e)},expression:"form.cfg_group"}}),e("div",{staticClass:"d-flex"},[e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:s}){return[e("span",t._g(t._b({staticClass:"mr-2"},"span",s,!1),i),[e("v-checkbox",{attrs:{color:"primary","true-value":1,"false-value":0},model:{value:t.form.cfg_client,callback:function(e){t.$set(t.form,"cfg_client",e)},expression:"form.cfg_client"}})],1)]}}],null,!1,1519726528)},[e("span",[t._v("클라이언트")])]),e("input-duplicate-check",{ref:"cfgKey",attrs:{label:"키",cbCheck:t.keyCheck,origin:t.originKey,readonly:!!t.item,rules:[t.rules.required({label:"키"}),...t.rules.cfgKey()]},model:{value:t.form.cfg_key,callback:function(e){t.$set(t.form,"cfg_key",e)},expression:"form.cfg_key"}})],1),e("v-text-field",{attrs:{label:"이름",rules:t.rules.name()},model:{value:t.form.cfg_name,callback:function(e){t.$set(t.form,"cfg_name",e)},expression:"form.cfg_name"}}),e("v-select",{attrs:{label:"값 유형",items:t.typeItems},model:{value:t.form.cfg_type,callback:function(e){t.$set(t.form,"cfg_type",e)},expression:"form.cfg_type"}}),e("type-value",{attrs:{fieldType:t.form.cfg_type},model:{value:t.form.cfg_val,callback:function(e){t.$set(t.form,"cfg_val",e)},expression:"form.cfg_val"}}),e("v-slider",{attrs:{label:`접근레벨 (${t.form.cfg_level})`,min:t.LV.ADMIN,max:t.user.user_level,"thumb-color":"primary","thumb-label":""},model:{value:t.form.cfg_level,callback:function(e){t.$set(t.form,"cfg_level",e)},expression:"form.cfg_level"}}),e("v-textarea",{attrs:{label:"설명"},model:{value:t.form.cfg_comment,callback:function(e){t.$set(t.form,"cfg_comment",e)},expression:"form.cfg_comment"}}),e("v-btn",{staticClass:"mt-5",attrs:{type:"submit",block:"",color:"primary"}},[t._v("Save")])],1):t._e()},c=[],f=i("91ca"),u=function(){var t=this,e=t._self._c;return"String"==t.fieldType?e("div",[e("v-text-field",{attrs:{label:"Value",value:t.value,readonly:t.readonly,"hide-details":t.readonly},on:{input:t.onInput}})],1):"Number"==t.fieldType?e("div",[e("v-text-field",{attrs:{label:"Value",type:"number",value:t.value,readonly:t.readonly,"hide-details":t.readonly},on:{input:t.onInput}})],1):"CheckBox"==t.fieldType?e("div",[e("v-checkbox",{attrs:{label:"Check Value","input-value":t.value,readonly:t.readonly,"hide-details":t.readonly,"true-value":"1","false-value":"0"},on:{change:t.onInput}})],1):"JSON"==t.fieldType?e("div",[t.readonly?[e("v-btn",{attrs:{color:"primary"},on:{click:t.jsonView}},[t._v("JSON 보기")]),e("my-dialog",{ref:"dialog",attrs:{label:"JSON 값 보기",width:"600",color:"primary"}},[e("pre",{staticClass:"mt-4"},[t._v(t._s(t.stringify()))])])]:e("v-textarea",{attrs:{label:"Value",value:t.value,readonly:t.readonly},on:{input:t.onInput}})],2):"Secret"==t.fieldType?e("div",[e("input-password",{attrs:{label:"Secret Value",value:t.value,readonly:t.readonly,"hide-details":t.readonly},on:{input:t.onInput}})],1):e("div",[e("div",[t._v("타입을 먼저 선택해 주세요.")])])},m=[],d=i("056e"),p=i("ac4f"),g=i.n(p),v={components:{InputPassword:d["a"],MyDialog:l["a"]},name:"TypeValue",model:{prop:"value",event:"input"},props:{value:{type:String},fieldType:{type:String,default:"String"},readonly:{type:Boolean,default:!1}},methods:{onInput(t){this.$emit("input",t)},stringify(){const t=JSON.parse(this.value);return g()(t,{space:"  "})},jsonView(){this.$refs.dialog.open()}}},h=v,_=i("2877"),y=Object(_["a"])(h,u,m,!1,null,null,null),b=y.exports,k=i("bb5e"),$=i("248f"),C=i.n($),x=i("64f2"),S=i("3807"),I={components:{InputDuplicateCheck:f["a"],TypeValue:b,InputLevel:S["a"]},name:"ConfigForm",props:{keyCheck:{type:Function,default:null},groupItems:{type:Array,default:[]},item:{type:Object,default:null}},data(){return{valid:!0,form:null,typeItems:["String","Number","CheckBox","JSON","Secret"],originKey:null}},computed:{LV:()=>k["LV"],rules:()=>C.a,...Object(o["e"])({user:t=>t.user.user})},created(){this.init()},watch:{item(){this.init()}},methods:{init(){if(this.item){if(this.form=Object(x["deepCopy"])(this.item),"JSON"==this.form.cfg_type){const t=JSON.parse(this.form.cfg_val);this.form.cfg_val=g()(t,{space:"  "})}this.originKey=this.item.cfg_key}else this.form={cfg_key:"",cfg_val:"",cfg_name:"",cfg_group:"",cfg_level:"",cfg_type:"String",cfg_comment:"",cfg_client:0},this.originKey="";this.$refs.form&&this.$refs.form.resetValidation()},async save(){if(this.$refs.form.validate(),await this.$nextTick(),this.valid&&this.$refs.cfgKey.validate()){if(!this.item){let t=0;const e=Object(x["findParentVm"])(this,"AdmConfig");e.items.forEach(e=>{e.cfg_group==this.form.cfg_group&&t++}),this.form.cfg_sort=t}try{if("JSON"==this.form.cfg_type){const t=JSON.parse(this.form.cfg_val);this.form.cfg_val=JSON.stringify(t)}this.$emit("save",this.form)}catch(t){this.$toast.error("JSON 형식이 올바르지 않습니다.")}}}}},O=I,w=Object(_["a"])(O,n,c,!1,null,null,null),N=w.exports,j=function(){var t=this,e=t._self._c;return t.user?e("li",[e("v-icon",{staticClass:"handle"},[t._v("mdi-drag")]),e("div",[e("div",[e("div",[e("b",[t._v(t._s(t.item.cfg_name))])]),e("div",[e("pre",{staticClass:"comment",domProps:{innerHTML:t._s(t.item.cfg_comment)}})]),e("div",[e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:s}){return[e("v-avatar",t._g(t._b({attrs:{color:"primary",dark:"",size:"32"}},"v-avatar",s,!1),i),[e("span",{staticClass:"white--text"},[t._v(t._s(t.item.cfg_level))])])]}}],null,!1,1779033706)},[e("span",[t._v("접근 레벨")])])],1),e("div",[e("v-btn",{attrs:{icon:"",disabled:t.isGrant},on:{click:function(e){return t.$emit("update",t.item)}}},[e("v-icon",[t._v("mdi-pencil")])],1)],1)]),e("div",[e("div",[e("b",[t._v(t._s(t.item.cfg_key))])]),e("div",[e("type-value",{attrs:{fieldType:t.item.cfg_type,value:t.item.cfg_val,readonly:!0}})],1),e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:s}){return[e("div",t._g(t._b({staticClass:"client"},"div",s,!1),i),[e("v-checkbox",{attrs:{readonly:"","hide-details":"",dense:""},model:{value:t.item.cfg_client,callback:function(e){t.$set(t.item,"cfg_client",e)},expression:"item.cfg_client"}})],1)]}}],null,!1,1650978897)},[e("span",[t._v("클라이언트 접근유무")])]),e("div",[e("v-btn",{attrs:{icon:"",disabled:t.isGrant},on:{click:function(e){return t.$emit("remove",t.item)}}},[e("v-icon",[t._v("mdi-delete")])],1)],1)],1)])],1):t._e()},T=[],V={components:{TypeValue:b},name:"ConfigItem",props:{item:{type:Object,required:!0}},computed:{...Object(o["e"])({user:t=>t.user.user}),isGrant(){return this.item.cfg_level>this.user.user_level}}},J=V,D=Object(_["a"])(J,j,T,!1,null,null,null),F=D.exports,K=i("b76a"),q=i.n(K),A={components:{TooltipBtn:r["a"],MyDialog:l["a"],ConfigForm:N,ConfigItem:F,draggable:q.a},name:"AdmConfig",title:"설정 관리",data(){return{items:[],group:-1,curItems:[],item:null,restart:!1}},computed:{...Object(o["e"])({online:t=>t.socket.online}),groupItems(){const t=new Set;return this.items.forEach(e=>{t.add(e.cfg_group)}),[...t]},groupName(){return this.groupItems[this.group]||""}},mounted(){this.fetchData()},watch:{online(){this.online&&(this.$toast.info("서버가 재시작 되었습니다."),this.restart=!1)},group(){this.setCurItems()}},methods:{...Object(o["b"])(["configDuplicateCheck","configSave"]),addConfig(){this.item=null,this.$refs.configForm&&this.$refs.configForm.init(),this.$refs.dialog.open()},updateConfig(t){this.item=t,this.$refs.configForm&&this.$refs.configForm.init(),this.$refs.dialog.open()},async removeConfig(t){const e=await this.$myNotify.confirm(`<b>[${t.cfg_name}]</b> 삭제하시겠습니까?`,"설정항목 삭제",{icon:"mdi-delete",iconColor:"red"});if(!e)return;const i=await this.$axios.delete("/api/config/"+t.cfg_key);if(i){t.cfg_client&&this.$socket.emit("config:remove",t.cfg_key),this.$toast.info(`[${t.cfg_name}] 삭제 하였습니다.`);const e=this.items.indexOf(t);this.items.splice(e,1),this.setCurItems()}},async save(t){const e=await this.configSave(t);if(e.cfg_client?this.$socket.emit("config:update",{key:e.cfg_key,value:e.cfg_val}):this.item&&this.item.cfg_client&&this.$socket.emit("config:remove",e.cfg_key),this.item){this.$toast.info(`[${t.cfg_name}] 수정 하였습니다.`);const i=this.items.indexOf(this.item);this.items.splice(i,1,e)}else this.$toast.info(`[${t.cfg_name}] 추가 하였습니다.`),this.items.push(e);this.setCurItems(),this.$refs.dialog.close()},async keyCheck(t){const e=await this.configDuplicateCheck({field:"cfg_key",value:t});return e},async fetchData(){this.items=await this.$axios.get("/api/config?all=true")},sortEnd(){let t=0;const e=[];this.curItems.forEach(i=>{i.cfg_sort=t++,e.push({cfg_key:i.cfg_key,cfg_sort:i.cfg_sort})}),this.$axios.put("/api/config",e)},setCurItems(){this.curItems=this.items.filter(t=>t.cfg_group==this.groupName).sort((t,e)=>t.cfg_sort-e.cfg_sort)},async restartServer(){const t=await this.$myNotify.confirm("서버 재시작 요청을 하시겠습니까?","서버 재시작",{icon:"mdi-power",iconColor:"red"});if(!t)return;this.restart=!0;const e=await this.$axios.get("/api/config/restart");e?setTimeout(()=>{this.restart&&(this.$toast.error("서버 재시작이 실패했습니다.\n잠시 후 다시 시도 하세요."),this.restart=!1)},1e4):this.restart=!1}}},B=A,E=Object(_["a"])(B,s,a,!1,null,null,null);e["default"]=E.exports},ed2f:function(t,e,i){"use strict";var s=function(){var t=this,e=t._self._c;return e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:s}){return[e("v-btn",t._g(t._b({class:t.childClass,attrs:{icon:""},on:{click:function(e){return t.$emit("click")}}},"v-btn",{...t.$attrs,...s},!1),i),[t._t("default")],2)]}}],null,!0)},[e("span",[t._v(t._s(t.label))])])},a=[],o={name:"TooltipBtn",props:{label:{type:String,required:!0},childClass:[String,Object]}},r=o,l=i("2877"),n=Object(l["a"])(r,s,a,!1,null,null,null);e["a"]=n.exports}}]);
//# sourceMappingURL=admConfig.701428f5.js.map